
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>PKM TGLK | SKRINING</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="keywords" />
    <meta content="" name="description" />

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700&family=Rubik:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <!-- Icon Font Stylesheet -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.1.8/css/dataTables.bootstrap5.css"
    />
    <!-- Libraries Stylesheet -->
    <link href="animate.min.css" rel="stylesheet" />
    <link href="owl.carousel.min.css" rel="stylesheet" />
    <link href="lightbox.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="bootstrap.min.css" rel="stylesheet" />

    <!-- DataTables JS -->
    <link
      href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"
      rel="stylesheet"
    />

    <!-- Template Stylesheet -->
    <link href="style.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@ttskch/select2-bootstrap4-theme@1.5.2/dist/select2-bootstrap4.min.css"
      rel="stylesheet"
    />

    <!-- jQuery & Select2 -->
<!--     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
      <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
  <style>
      .header img {
        height: 80px;
      }
      .highlight-number {
        font-size: 1.5rem;
        font-weight: bold;
        color: #007bff;
      }
      #loading-page {
        position: fixed;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        font-weight: bold;
        color: #007bff;
        z-index: 9999;
      }
      .card-e:hover {
        transform: scale(1.05);
        transition: 0.3s ease-in-out;
      }
  </style>  
  </head>

  <body>
    <!-- Spinner Start -->
    <div
      id="spinner"
      class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center"
    >
      <div
        class="spinner-border text-primary"
        style="width: 3rem; height: 3rem"
        role="status"
      >
        <span class="sr-only">Loading...</span>
      </div>
    </div>
    <!-- Spinner End -->

    <!-- Navbar & Hero Start -->
    <div class="container-fluid header position-relative overflow-hidden p-0">
      <nav
        class="navbar navbar-expand-lg fixed-top navbar-light px-4 px-lg-5 py-3 py-lg-0"
      >
        <a href="index.html" class="navbar-brand p-0">
          <h1 class="display-6 text-primary m-0">
            <i class="fas fa-hand-holding-medical"></i> Puskesmas Trenggalek
          </h1>
          <!-- <img src="img/logo.png" alt="Logo"> -->
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarCollapse"
        >
          <span class="fa fa-bars"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <div class="navbar-nav ms-auto py-0">
            <a href="index.html" class="nav-item nav-link">Home</a>
            <a href="screening.html" class="nav-item nav-link">Screening</a>
            <a href="contact.html" class="nav-item nav-link">Contact Us</a>
          </div>
          <!-- <a
            href="#"
            class="btn btn-light border border-primary rounded-pill text-primary py-2 px-4 me-4"
            >Log In</a
          >
          <a href="#" class="btn btn-primary rounded-pill text-white py-2 px-4"
            >Sign Up</a
          > -->
        </div>
      </nav>

      <!-- Hero Header Start -->
      <div class="hero-header overflow-hidden px-5">
        <div class="rotate-img">
          <img src="img/sty-1.png" class="img-fluid w-100" alt="" />
          <div class="rotate-sty-2"></div>
        </div>
<!--         https://docs.google.com/spreadsheets/d/1b-t0uL56KjwjFl0BbzNTp0my2yTaYqrwgosDyXDuDsM/edit?usp=sharing -->
        
    
         <body class="bg-light">
    <div id="loading-page">Memuat data...</div>
    <div class="container my-4">
      <div class="card shadow">
        <div class="card-body">
          <div class="header text-center mb-3">
            <h2>REKAP SKRINING KLASTER 3</h2>
            <p><strong>INDUK PUSKESMAS TRENGGALEK</strong></p>
          </div>

          <!-- Filter Section -->
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="tahun">Tahun:</label>
              <select id="tahun" class="form-select select2">
                <option value="">Pilih Tahun</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="bulan">Bulan:</label>
              <select id="bulan" class="form-select select2">
                <option value="">Semua Bulan</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="petugas">Petugas:</label>
              <select id="petugas" class="form-select select2">
                <option value="">Semua Petugas</option>
              </select>
            </div>
          </div>

          <!-- Cards Section -->
          <div class="row text-center">
            <div class="col-md-4">
              <div class="card card-e mt-3 shadow">
                <div class="card-body">
                  <h5 class="card-title">Total Skrining</h5>
                  <p class="highlight-number" id="total-skrining">0</p>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card card-e mt-3 shadow">
                <div class="card-body">
                  <h5 class="card-title">Total Skrining 18-59 TH</h5>
                  <p class="highlight-number" id="total-skrining-18-59">0</p>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card card-e mt-3 shadow">
                <div class="card-body">
                  <h5 class="card-title">Total Skrining 60 TH</h5>
                  <p class="highlight-number" id="total-skrining-60">0</p>
                </div>
              </div>
            </div>
          </div>

          
           <table class="table table-bordered text-center mt-4 shadow">
            <thead class="table-primary">
                <tr>
                    <th rowspan="2">NO</th>
                    <th rowspan="2">INDIKATOR</th>
                    <th colspan="2">18-59 TH</th>
                    <th colspan="2">60 TH</th>
                </tr>
                <tr>
                    <th>Total Skrining</th>
                    <th>Ditemukan</th>
                    <th>Total Skrining</th>
                    <th>Ditemukan</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td class="text-start">Skrining Obesitas</td>
                    <td id="Skriningobesitas-59">-</td>
                    <td id="Skriningobesitas-59TEMU">-</td>
                    <td id="skriningHT-60">-</td>
                    <td id="skrinigHT-60ketemu">-</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td class="text-start">Skrining HT</td>
                    <td id="ht-59">-</td>
                    <td id="ht-59temu">-</td>
                    <td id="ht-60">-</td>
                    <td id="ht-60temu">-</td>
                </tr>
                
            </tbody>
        </table>

        </div>
      </div>
    </div>

    
 


        <!-- </div> -->
      </div>

      <!-- Hero Header End -->
    </div>
    <!-- Navbar & Hero End -->

    <!-- Copyright Start -->
    <div class="container-fluid copyright py-2 fixed-bottom">
      <div class="container">
        <div class="row g-4 align-items-center">
          <div class="col-md-6 text-center text-md-start mb-md-0">
            <span class="text-white"
              ><a href="#"
                ><i class="fas fa-copyright text-light me-2"></i>Skrining
                Puskesmas Trenggalek</a
              >
              , All right reserved.</span
            >
          </div>
          <div class="col-md-6 text-center text-md-end text-white">
            Designed By
            <a class="border-bottom" href="https://htmlcodex.com"
              >@Yoga | 2024</a
            >
            <!-- Distributed By
            <a class="border-bottom" href="https://themewagon.com"
              >ThemeWagon</a
            > -->
          </div>
        </div>
      </div>
    </div>
    <!-- Copyright End -->

    <!-- Back to Top -->
    <!-- <a href="#" class="btn btn-primary btn-lg-square back-to-top"
      ><i class="fa fa-arrow-up"></i
    ></a> -->

  
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="wow.min.js"></script>
    <script src="easing.min.js"></script>
    <script src="waypoints.min.js"></script>
    <script src="counterup.min.js"></script>
    <script src="owl.carousel.min.js"></script>
    <script src="lightbox.min.js"></script>

    <!-- Template Javascript -->
    <script src="main.js"></script>
      
    <script>
       $(document).ready(function () {
        $(".select2").select2({
          theme: "bootstrap4",
          width: "100%",
          allowClear: true,
        });

        const apiUrl = "https://script.google.com/macros/s/AKfycbxeDPM5nRIt7TeTfKTgL4PSyCFzzhNlHVbo-jUcSjoeif7dkZYdAvFagPIVH1YnXoOi/exec";

        $("#loading-page").show();

        fetch(apiUrl)
          .then((response) => response.json())
          .then((data) => {
            $("#loading-page").fadeOut(500);

            let petugasSet = new Set();
            let tahunSet = new Set();
            let bulanSet = new Set();

            data.forEach((item) => {
              if (item.Petugas) {
                item.Petugas.split(",").forEach((p) => petugasSet.add(p.trim()));
              }
              if (item.TANGGAL) {
                let date = new Date(item.TANGGAL);
                if (!isNaN(date)) {
                  tahunSet.add(date.getFullYear());
                  bulanSet.add(date.getMonth() + 1);
                }
              }
            });

            $("#tahun").append([...tahunSet].map((tahun) => `<option value="${tahun}">${tahun}</option>`));
            $("#petugas").append([...petugasSet].map((petugas) => `<option value="${petugas}">${petugas}</option>`));

            const bulanNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            $("#bulan").append([...bulanSet].map((bulan) => `<option value="${bulan}">${bulanNames[bulan - 1]}</option>`));

            function filterData() {
              const selectedTahun = $("#tahun").val();
              const selectedBulan = $("#bulan").val();
              const selectedPetugas = $("#petugas").val();

              const filteredData = data.filter((item) => {
                return (!selectedTahun || new Date(item.TANGGAL).getFullYear() == selectedTahun) &&
                       (!selectedBulan || new Date(item.TANGGAL).getMonth() + 1 == selectedBulan) &&
                       (!selectedPetugas || item.Petugas?.includes(selectedPetugas));
              });

              $("#total-skrining").text(filteredData.length);
              $("#total-skrining-18-59").text(filteredData.filter(item => !isNaN(parseInt(item.USIA)) && parseInt(item.USIA) <= 59).length);
              $("#total-skrining-60").text(filteredData.filter(item => !isNaN(parseInt(item.USIA)) && parseInt(item.USIA) >= 60 ).length);
              $("#Skriningobesitas-59").text(filteredData.filter(item => item.Dilakukan_skrining_obesitas && parseInt(item.USIA) <= 59).length);
              $("#Skriningobesitas-59TEMU").text(filteredData.filter(item => item.Hasil_obesitas && parseInt(item.USIA) <= 59).length);
              $("#skriningHT-60").text(filteredData.filter(item => item.Dilakukan_skrining_obesitas && parseInt(item.USIA) >= 60).length);
              $("#skrinigHT-60ketemu").text(filteredData.filter(item => item.Hasil_obesitas && parseInt(item.USIA) >= 60).length);
              $("#ht-59").text(filteredData.filter(item => item.Dilakukan_skrining_HT && parseInt(item.USIA) <= 59).length);
              $("#ht-59temu").text(filteredData.filter(item => item.Ditemukan_HT && parseInt(item.USIA) <= 59).length);
              $("#ht-60").text(filteredData.filter(item => item.Dilakukan_skrining_HT && parseInt(item.USIA) >= 60).length);
              $("#ht-60temu").text(filteredData.filter(item => item.Ditemukan_HT && parseInt(item.USIA) >= 60).length);
            }

            $("#tahun, #bulan, #petugas").on("change", filterData);
          });
      });
    </script>
  </body>
</html>
