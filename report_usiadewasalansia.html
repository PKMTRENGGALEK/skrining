
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>PKM TGLK | SKRINING</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="keywords" />
    <meta content="" name="description" />

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700&family=Rubik:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <!-- Icon Font Stylesheet -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.1.8/css/dataTables.bootstrap5.css"
    />
    <!-- Libraries Stylesheet -->
    <link href="animate.min.css" rel="stylesheet" />
    <link href="owl.carousel.min.css" rel="stylesheet" />
    <link href="lightbox.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="bootstrap.min.css" rel="stylesheet" />

    <!-- DataTables JS -->
    <link
      href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"
      rel="stylesheet"
    />

    <!-- Template Stylesheet -->
    <link href="style.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Spinner Start -->
    <div
      id="spinner"
      class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center"
    >
      <div
        class="spinner-border text-primary"
        style="width: 3rem; height: 3rem"
        role="status"
      >
        <span class="sr-only">Loading...</span>
      </div>
    </div>
    <!-- Spinner End -->

    <!-- Navbar & Hero Start -->
    <div class="container-fluid header position-relative overflow-hidden p-0">
      <nav
        class="navbar navbar-expand-lg fixed-top navbar-light px-4 px-lg-5 py-3 py-lg-0"
      >
        <a href="index.html" class="navbar-brand p-0">
          <h1 class="display-6 text-primary m-0">
            <i class="fas fa-hand-holding-medical"></i> Puskesmas Trenggalek
          </h1>
          <!-- <img src="img/logo.png" alt="Logo"> -->
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarCollapse"
        >
          <span class="fa fa-bars"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <div class="navbar-nav ms-auto py-0">
            <a href="index.html" class="nav-item nav-link">Home</a>
            <a href="screening.html" class="nav-item nav-link">Screening</a>
            <a href="contact.html" class="nav-item nav-link">Contact Us</a>
          </div>
          <!-- <a
            href="#"
            class="btn btn-light border border-primary rounded-pill text-primary py-2 px-4 me-4"
            >Log In</a
          >
          <a href="#" class="btn btn-primary rounded-pill text-white py-2 px-4"
            >Sign Up</a
          > -->
        </div>
      </nav>

      <!-- Hero Header Start -->
      <div class="hero-header overflow-hidden px-5">
        <div class="rotate-img">
          <img src="img/sty-1.png" class="img-fluid w-100" alt="" />
          <div class="rotate-sty-2"></div>
        </div>
<!--         https://docs.google.com/spreadsheets/d/1b-t0uL56KjwjFl0BbzNTp0my2yTaYqrwgosDyXDuDsM/edit?usp=sharing -->
        
    
  
    <div class="container my-4">
      <div class="card shadow">
        <div class="card-body">

          <div class="header text-center mb-3">
            <h2>REKAP SKRINING KLASTER 3</h2>
            <p><strong>INDUK PUSKESMAS TRENGGALEK</strong></p>
          </div>

          <!-- Filter Section -->
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="tahun">Tahun:</label>
              <select id="tahun" class="form-select select2">
                <option value="">Pilih Tahun</option>
                <!-- <option value="2024">2024</option> -->
                <option value="2025">2025</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="bulan">Bulan:</label>
              <select id="bulan" class="form-select select2">
                <option value="">Semua Bulan</option>
                <option value="1">Januari</option>
                <option value="2">Februari</option>
                <option value="3">Maret</option>
                <option value="4">April</option>
                <option value="5">Mei</option>
                <option value="6">Juni</option>
                <option value="7">Juli</option>
                <option value="8">Agustus</option>
                <option value="9">September</option>
                <option value="10">Oktober</option>
                <option value="11">November</option>
                <option value="12">Desember</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="petugas">Petugas:</label>
              <select id="petugas" class="form-select select2"></select>
            </div>
            
            </div>
          </div>

          <!-- Total Section -->
          <div class="row text-center">
            <div class="col-md-4">
              <p>Total Skrining Klaster 3:</p>
              <p class="highlight-number" id="total-klaster">0</p>
            </div>
            <div class="col-md-4">
              <p>Total Skrining 18-59 Tahun:</p>
              <p class="highlight-number" id="total-18-59">0</p>
            </div>
            <div class="col-md-4">
              <p>Total Skrining â‰¥60 Tahun:</p>
              <p class="highlight-number" id="total-60">0</p>
            </div>
          </div>
          <div class="container">
            <!-- Tabel Rekap Skrining -->
            <div class="table-responsive mt-4">
                <table class="table table-bordered table-striped">
                <thead class="table-primary text-center">
                    <tr>
                    <th rowspan="2">NO</th>
                    <th rowspan="2">INDIKATOR</th>
                    <th colspan="2">18-59 TH</th>
                    <th colspan="2">60 TH</th>
                    </tr>
                    <tr>
                    <th>TOTAL SKRINING</th>
                    <th>DITEMUKAN</th>
                    <th>TOTAL SKRINING</th>
                    <th>DITEMUKAN</th>
                    </tr>
                </thead>
                <tbody id="rekap-tbody">
                    <tr>
                        <td>1</td>
                        <td>SKRINING OBESITAS</td>
                        <td id="total-18-59-obesitas" class="text-center"></td>
                        <td id="totalditemukanobesitas" class="text-center"></td>
                        <td id="total60-obesitas" class="text-center"></td>
                        <td id="total60obesitas" class="text-center"></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>SKRINING HT</td>
                        <td id="total-18-59-HT" class="text-center"></td>
                        <td id="totalditemukanHT" class="text-center"></td>
                        <td id="total60-HT" class="text-center"></td>
                        <td id="total60HT" class="text-center"></td>
                    </tr>
                </tbody>
                </table>
            </div>
          </div>
          
        </div>
      </div>
    </div>

    
 


        <!-- </div> -->
      </div>

      <!-- Hero Header End -->
    </div>
    <!-- Navbar & Hero End -->

    <!-- Copyright Start -->
    <div class="container-fluid copyright py-2 fixed-bottom">
      <div class="container">
        <div class="row g-4 align-items-center">
          <div class="col-md-6 text-center text-md-start mb-md-0">
            <span class="text-white"
              ><a href="#"
                ><i class="fas fa-copyright text-light me-2"></i>Skrining
                Puskesmas Trenggalek</a
              >
              , All right reserved.</span
            >
          </div>
          <div class="col-md-6 text-center text-md-end text-white">
            Designed By
            <a class="border-bottom" href="https://htmlcodex.com"
              >@Yoga | 2024</a
            >
            <!-- Distributed By
            <a class="border-bottom" href="https://themewagon.com"
              >ThemeWagon</a
            > -->
          </div>
        </div>
      </div>
    </div>
    <!-- Copyright End -->

    <!-- Back to Top -->
    <!-- <a href="#" class="btn btn-primary btn-lg-square back-to-top"
      ><i class="fa fa-arrow-up"></i
    ></a> -->

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="wow.min.js"></script>
    <script src="easing.min.js"></script>
    <script src="waypoints.min.js"></script>
    <script src="counterup.min.js"></script>
    <script src="owl.carousel.min.js"></script>
    <script src="lightbox.min.js"></script>

    <!-- Template Javascript -->
    <script src="main.js"></script>
    <script>
      $(document).ready(function () {
        $(".select2").select2({
          theme: "bootstrap4",
          width: "100%",
          allowClear: true,
        });

        const apiUrl =
          "https://script.google.com/macros/s/AKfycbxeDPM5nRIt7TeTfKTgL4PSyCFzzhNlHVbo-jUcSjoeif7dkZYdAvFagPIVH1YnXoOi/exec";
        $("#loading").show(); // Tampilkan loading sebelum fetch data
        fetch(apiUrl)
          .then((response) => response.json())
          .then((data) => {
            $("#loading").hide(); // Sembunyikan loading setelah data dimuat
            let petugasSet = new Set();
            data.forEach((item) => {
              if (item.Petugas) {
                item.Petugas.split(",").forEach((p) =>
                  petugasSet.add(p.trim())
                );
              }
            });

            $("#petugas").append('<option value="">Semua Petugas</option>');
            petugasSet.forEach((petugas) => {
              $("#petugas").append(
                `<option value="${petugas}">${petugas}</option>`
              );
            });
            
            // Event listener for filters
            $("#petugas, #bulan, #tahun").on("change", filterData);

            function filterData() {
             
                const selectedTahun = $("#tahun").val();
                const selectedPetugas = $("#petugas").val();
                const selectedBulan = $("#bulan").val();

                const filteredData = data.filter((item) => {
                  const petugasMatch = selectedPetugas
                    ? item.Petugas?.split(",")
                        .map((p) => p.trim())
                        .includes(selectedPetugas)
                    : true;
                  const bulanMatch = selectedBulan
                    ? item.TANGGAL &&
                      new Date(item.TANGGAL).getMonth() + 1 == selectedBulan
                    : true;
                  const tahunMatch = selectedTahun
                    ? item.TANGGAL &&
                      new Date(item.TANGGAL).getFullYear() == selectedTahun
                    : true;
                  return petugasMatch && bulanMatch && tahunMatch;
                });
                //obesitas
                const total18_59 = filteredData.filter(
                  (item) => parseInt(item.USIA || 0 ) <= 59
                ).length;
                const totalobesitas = filteredData.filter(
                  (item) =>  parseInt(item.USIA || 0 ) <= 59 && (item.Dilakukan_skrining_obesitas   = 'YA')
                ).length;
                const ditemukanobesitas = filteredData.filter(
                  (item) =>parseInt(item.USIA || 0 ) <= 59 && (item.Hasil_obesitas == 1)
                ).length;
                const totalobesitas60 = filteredData.filter(
                  (item) =>  parseInt(item.USIA || 0 ) >= 60 && (item.Dilakukan_skrining_obesitas   = 'YA')
                ).length;
                const ditemukanobesitas60 = filteredData.filter(
                  (item) =>parseInt(item.USIA || 0 ) >= 60 && (item.Hasil_obesitas == 1)
                ).length;
                const total60 = filteredData.filter(
                  (item) => parseInt(item.USIA || 0) >= 60
                ).length;
                //HT
                const totalHT = filteredData.filter(
                  (item) =>  parseInt(item.USIA || 0 ) <= 59 && (item.Dilakukan_skrining_HT   = 'YA')
                ).length;
                const ditemukanHT = filteredData.filter(
                  (item) =>parseInt(item.USIA || 0 ) <= 59 && (item.Ditemukan_HT == 1)
                ).length;
                const totalHT60 = filteredData.filter(
                  (item) =>  parseInt(item.USIA || 0 ) >= 60 && (item.Dilakukan_skrining_HT   = 'YA')
                ).length;
                const ditemukanHT60 = filteredData.filter(
                  (item) =>parseInt(item.USIA || 0 ) >= 60 && (item.Ditemukan_HT == 1)
                ).length;

                $("#total-18-59").text(total18_59);
                $("#total-18-59-obesitas").text(totalobesitas);

                $("#total-18-59-HT").text(totalHT);
                $("#totalditemukanHT").text(ditemukanHT);
                $("#total60-HT").text(totalHT60);
                $("#total60HT").text(ditemukanHT60);


                $("#totalditemukanobesitas").text(ditemukanobesitas);
                $("#total60-obesitas").text(totalobesitas60);
                $("#total60obesitas").text(ditemukanobesitas60);
                $("#total-60").text(total60);
                $("#total-klaster").text(total18_59 + total60);
                
            }
          })
          .catch((error) => console.error("Error fetching data:", error));
      });
      
    </script>
  </body>
</html>
